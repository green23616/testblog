# Supabase Setup Guide

Follow these steps to set up your Supabase database for the test blog.

---

## Step 1: Create Supabase Project

1. Go to [supabase.com](https://supabase.com)
2. Sign in or create a free account
3. Click **"New Project"**
4. Fill in the details:
   - **Name**: `testblog` (or any name you prefer)
   - **Database Password**: Create a strong password (save it!)
   - **Region**: Choose closest to you
   - **Pricing Plan**: Free tier is fine for testing
5. Click **"Create new project"**
6. Wait 1-2 minutes for setup to complete

---

## Step 2: Run Database Schema

1. In your Supabase dashboard, click **"SQL Editor"** in the left sidebar
2. Click **"New query"**
3. Open the file `/Users/jwk/Documents/Vsc/testblog/supabase/schema.sql` on your computer
4. Copy **ALL** the SQL code from that file
5. Paste it into the Supabase SQL Editor
6. Click **"Run"** (or press Cmd/Ctrl + Enter)
7. You should see: ✅ **"Success. No rows returned"**

**What this creates:**
- 4 tables: `posts`, `tags`, `post_tags`, `comments`
- Security policies (RLS)
- Performance indexes
- Sample data (2 posts, 5 tags)

---

## Step 3: Get Your API Keys

1. In Supabase dashboard, click **"Settings"** (gear icon in left sidebar)
2. Click **"API"** in the settings menu
3. You'll see two sections:

### Project URL
- Copy the URL under **"Project URL"**
- Example: `https://abcdefghijk.supabase.co`

### API Keys
- Copy **"anon public"** key (long string starting with `eyJ...`)
- Scroll down to **"service_role"** (click the eye icon to reveal)
- Copy the **"service_role"** key

---

## Step 4: Update Environment Variables

1. Open `/Users/jwk/Documents/Vsc/testblog/.env.local` in a text editor
2. Replace the placeholders:

```bash
# Replace these with your actual values
NEXT_PUBLIC_SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGc...YOUR_ANON_KEY
SUPABASE_SERVICE_ROLE_KEY=eyJhbGc...YOUR_SERVICE_ROLE_KEY

# Keep this as is
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

3. Save the file

---

## Step 5: Verify Setup

### Check Tables Were Created
1. In Supabase dashboard, click **"Table Editor"**
2. You should see 4 tables:
   - `posts` (2 rows)
   - `tags` (5 rows)
   - `post_tags` (3 rows)
   - `comments` (0 rows)

### Check Sample Data
1. Click on the **`posts`** table
2. You should see:
   - "Hello World - First Post"
   - "Getting Started with Next.js 16"

---

## Step 6: Test the Application

1. Open terminal in the project directory
2. Run the development server:
   ```bash
   cd /Users/jwk/Documents/Vsc/testblog
   pnpm dev
   ```

3. Open browser to [http://localhost:3000](http://localhost:3000)

4. Click **"View Blog Posts"**

5. You should see the 2 sample posts with:
   - Titles
   - Excerpts
   - Tags
   - View counts
   - Time ago

6. Click on a post to view the full post page

7. Refresh the page - view count should increment!

---

## Step 7: Verify Everything Works

### ✅ Checklist:

- [ ] Supabase project created
- [ ] Schema SQL executed successfully
- [ ] 4 tables visible in Table Editor
- [ ] 2 sample posts exist in `posts` table
- [ ] API keys copied to `.env.local`
- [ ] `pnpm dev` runs without errors
- [ ] Homepage loads at localhost:3000
- [ ] `/blog` page shows 2 posts
- [ ] Can click and view individual posts
- [ ] View count increments on refresh
- [ ] Tags display on post pages

---

## Troubleshooting

### Error: "Invalid API key"
- Double-check your `.env.local` file
- Make sure you copied the FULL key (they're very long)
- Restart the dev server: `Ctrl+C` then `pnpm dev`

### Error: "relation 'posts' does not exist"
- The schema wasn't run properly
- Go back to SQL Editor and run `supabase/schema.sql` again

### No posts showing on /blog page
- Check Supabase Table Editor - are there posts in the `posts` table?
- Check that `published` column is `true` for the posts
- Check browser console for errors (F12)

### View count not incrementing
- Check that the `increment_view_count` function was created
- In SQL Editor, run: `SELECT * FROM pg_proc WHERE proname = 'increment_view_count';`
- Should return 1 row

---

## Next Steps

Once everything is working:
1. Explore the Supabase dashboard
2. Try creating a new post directly in Table Editor
3. Experiment with the data
4. Get ready for Phase 3: Admin Dashboard!

---

## Security Note

**IMPORTANT**: Never commit `.env.local` to Git!

The `.gitignore` file already excludes it, but double-check:
```bash
git status
```

`.env.local` should NOT appear in the list.

---

## Need Help?

Common issues:
- **Wrong API URL format**: Should start with `https://` and end with `.supabase.co`
- **Keys mixed up**: `anon` key is public, `service_role` is secret
- **Restart needed**: Always restart dev server after changing `.env.local`

---

**Setup Time**: ~10 minutes
**Difficulty**: Easy
**Cost**: Free (Supabase free tier)
